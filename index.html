<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Simple Land Value Calculator</title>
  <style>
    :root {
      --bg: #ffffff;
      --panel: #ffffff;
      --ink: #000;
      --muted: #333;
      --line: #888;
      --warning: #000;
      --shadow: rgba(0, 0, 0, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Avenir Next", "Segoe UI", sans-serif;
      color: var(--ink);
      background: #ffffff;
      min-height: 100vh;
    }

    .app {
      width: min(1200px, 94vw);
      margin: 28px auto;
      display: grid;
      gap: 16px;
    }

    .layout {
      display: grid;
      gap: 16px;
      grid-template-columns: minmax(300px, 0.95fr) minmax(360px, 1.2fr);
      align-items: start;
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: 0 10px 28px var(--shadow);
      padding: 18px;
    }

    .inputs {
      display: grid;
      gap: 14px;
    }

    fieldset {
      margin: 0;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
      display: grid;
      gap: 10px;
    }

    legend {
      font-size: 0.82rem;
      text-transform: uppercase;
      color: var(--muted);
      letter-spacing: 0.06em;
      padding: 0 6px;
    }

    .row {
      display: grid;
      gap: 8px;
      grid-template-columns: 1.1fr 0.9fr;
      align-items: center;
    }

    .row label {
      font-size: 0.91rem;
      color: var(--ink);
    }

    .row input,
    .row select {
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 8px;
      background: #ffffff;
      padding: 7px 9px;
      font-size: 0.9rem;
      color: var(--ink);
    }

    .row input:focus,
    .row select:focus {
      outline: 2px solid rgba(0, 0, 0, 0.2);
      border-color: #000;
    }

    .actions {
      display: flex;
      justify-content: flex-start;
      margin-top: 4px;
    }

    button {
      border: 1px solid #000;
      background: #ffffff;
      color: #000;
      padding: 8px 12px;
      border-radius: 9px;
      font-weight: 700;
      font-size: 0.86rem;
      cursor: pointer;
      transition: transform 120ms ease;
    }

    button:hover {
      transform: translateY(-1px);
    }

    .outputs {
      display: grid;
      gap: 14px;
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
    }

    .metric {
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #ffffff;
      padding: 10px;
      display: grid;
      gap: 4px;
    }

    .metric .label {
      color: var(--muted);
      font-size: 0.78rem;
      letter-spacing: 0.02em;
    }

    .metric .value {
      font-size: 1.08rem;
      font-weight: 700;
      line-height: 1.2;
    }

    .metric .value.danger {
      color: var(--warning);
    }

    .warnings {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px;
      font-size: 0.85rem;
      background: #ffffff;
      display: none;
      gap: 4px;
    }

    .warnings.show {
      display: grid;
    }

    .table-wrap {
      border: 1px solid var(--line);
      border-radius: 11px;
      overflow: hidden;
      background: #ffffff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.89rem;
    }

    th,
    td {
      padding: 8px 10px;
      border-bottom: 1px solid #ccc;
      vertical-align: top;
    }

    th {
      width: 72%;
      text-align: left;
      font-weight: 600;
      color: #000;
      background: #ffffff;
    }

    td {
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    tr.group th {
      background: #ffffff;
      color: #000;
      font-weight: 800;
      font-family: "Trebuchet MS", "Gill Sans", sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.02em;
      font-size: 0.8rem;
    }

    tr.final th,
    tr.final td {
      font-weight: 800;
      font-size: 0.96rem;
      background: #ffffff;
    }

    @media (max-width: 1020px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 720px) {
      .card-grid {
        grid-template-columns: 1fr;
      }

      .row {
        grid-template-columns: 1fr;
      }

      th,
      td {
        padding: 7px 8px;
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <section class="layout">
      <form class="panel inputs" id="inputs">
        <fieldset>
          <legend>Project Basics</legend>
          <div class="row">
            <label for="landSizeHa">Land Size (ha)</label>
            <input id="landSizeHa" name="landSizeHa" type="number" min="0" step="0.01">
          </div>
          <div class="row">
            <label for="developablePct">Developable Area (%)</label>
            <input id="developablePct" name="developablePct" type="number" min="0" max="100" step="0.01">
          </div>
          <div class="row">
            <label for="minimumLotSqm">Minimum Lot Size (sqm)</label>
            <input id="minimumLotSqm" name="minimumLotSqm" type="number" min="1" step="1">
          </div>
        </fieldset>

        <fieldset>
          <legend>Sales and GST</legend>
          <div class="row">
            <label for="gstMode">GST Mode</label>
            <select id="gstMode" name="gstMode">
              <option value="margin">Margin Scheme</option>
              <option value="gst">GST</option>
            </select>
          </div>
          <div class="row">
            <label for="salePricePerLot">Sale Price per Lot (incl GST)</label>
            <input id="salePricePerLot" name="salePricePerLot" type="number" min="0" step="0.01">
          </div>
          <div class="row" id="marginPurchasePriceRow">
            <label for="marginPurchasePrice">Purchase Price for Margin GST</label>
            <input id="marginPurchasePrice" name="marginPurchasePrice" type="number" min="0" step="0.01">
          </div>
        </fieldset>

        <fieldset>
          <legend>Selling Costs</legend>
          <div class="row">
            <label for="titlesLegalsPerLot">Titles and Legals per Lot</label>
            <input id="titlesLegalsPerLot" name="titlesLegalsPerLot" type="number" min="0" step="0.01">
          </div>
          <div class="row">
            <label for="marketingPct">Marketing Allowance (%)</label>
            <input id="marketingPct" name="marketingPct" type="number" min="0" step="0.01">
          </div>
          <div class="row">
            <label for="agentsPct">Agents Commissions (%)</label>
            <input id="agentsPct" name="agentsPct" type="number" min="0" step="0.01">
          </div>
        </fieldset>

        <fieldset>
          <legend>Margin and Cost Stack</legend>
          <div class="row">
            <label for="targetMarginPct">Target Development Margin (%)</label>
            <input id="targetMarginPct" name="targetMarginPct" type="number" min="0" step="0.01">
          </div>
          <div class="row">
            <label for="constructionCost">Construction Costs</label>
            <input id="constructionCost" name="constructionCost" type="number" min="0" step="0.01">
          </div>
          <div class="row">
            <label for="contingencyPct">Construction Contingency (%)</label>
            <input id="contingencyPct" name="contingencyPct" type="number" min="0" step="0.01">
          </div>
          <div class="row">
            <label for="professionalFees">Professional Fees</label>
            <input id="professionalFees" name="professionalFees" type="number" min="0" step="0.01">
          </div>
          <div class="row">
            <label for="headworksCharges">Council Headworks / Infrastructure</label>
            <input id="headworksCharges" name="headworksCharges" type="number" min="0" step="0.01">
          </div>
          <div class="row">
            <label for="councilFees">Council Fees</label>
            <input id="councilFees" name="councilFees" type="number" min="0" step="0.01">
          </div>
          <div class="row">
            <label for="acquisitionCosts">Acquisition Costs</label>
            <input id="acquisitionCosts" name="acquisitionCosts" type="number" min="0" step="0.01">
          </div>
          <div class="row">
            <label for="ratesTaxes">Rates and Taxes</label>
            <input id="ratesTaxes" name="ratesTaxes" type="number" min="0" step="0.01">
          </div>
          <div class="row">
            <label for="interestFinanceCosts">Interest / Finance Costs</label>
            <input id="interestFinanceCosts" name="interestFinanceCosts" type="number" min="0" step="0.01">
          </div>
          <div class="row">
            <label for="gstReclaimed">GST Reclaimed (Add Back)</label>
            <input id="gstReclaimed" name="gstReclaimed" type="number" min="0" step="0.01">
          </div>
        </fieldset>

        <div class="actions">
          <button type="button" id="resetDefaults">Reset to PDF Defaults</button>
        </div>
      </form>

      <section class="panel outputs">
        <div class="card-grid">
          <article class="metric">
            <span class="label">Residual Land Value (DA Approved, Ex GST)</span>
            <span class="value" id="outLandValue">$0</span>
          </article>
          <article class="metric">
            <span class="label">Development Profit</span>
            <span class="value" id="outProfit">$0</span>
          </article>
          <article class="metric">
            <span class="label">Development Margin</span>
            <span class="value" id="outMargin">0%</span>
          </article>
        </div>

        <div class="warnings" id="warnings"></div>

        <div class="table-wrap">
          <table>
            <tbody>
              <tr class="final">
                <th>Project Overview</th>
                <td></td>
              </tr>
              <tr>
                <th>Land Size (ha)</th>
                <td id="outLandSizeHa">0</td>
              </tr>
              <tr>
                <th>Developable Area (ha)</th>
                <td id="outDevelopableArea">0</td>
              </tr>
              <tr>
                <th>Calculated Lots (from area + lot size)</th>
                <td id="outTotalLots">0</td>
              </tr>
              <tr>
                <th>Sale Price per Lot (incl GST)</th>
                <td id="outSalePricePerLot">$0</td>
              </tr>

              <tr class="final">
                <th>Cashflow Feasibility</th>
                <td></td>
              </tr>
              <tr>
                <th>Gross Realisation (incl GST)</th>
                <td id="outGrossRealisation">$0</td>
              </tr>
              <tr>
                <th>Titles and Legals</th>
                <td id="outTitlesLegals">$0</td>
              </tr>
              <tr>
                <th>Marketing and Commissions</th>
                <td id="outMarketingCommissions">$0</td>
              </tr>
              <tr>
                <th>GST Sales Remittance</th>
                <td id="outGstSalesRemittance">$0</td>
              </tr>
              <tr>
                <th>Total Selling Costs</th>
                <td id="outSellingCostsTotal">$0</td>
              </tr>
              <tr>
                <th>Net Realisation</th>
                <td id="outNetRealisation">$0</td>
              </tr>
              <tr>
                <th>Margin for Profit and Risk</th>
                <td id="outMarginForRisk">$0</td>
              </tr>
              <tr>
                <th>Balance After Risk Margin</th>
                <td id="outAfterRisk">$0</td>
              </tr>
              <tr>
                <th>Construction Costs (incl contingency + fees)</th>
                <td id="outConstructionCostsTotal">$0</td>
              </tr>
              <tr>
                <th>Balance After Construction</th>
                <td id="outAfterConstruction">$0</td>
              </tr>
              <tr>
                <th>Purchase and Holding Costs</th>
                <td id="outPurchaseHoldingTotal">$0</td>
              </tr>
              <tr>
                <th>Balance After Purchase / Holding</th>
                <td id="outAfterPurchaseHolding">$0</td>
              </tr>
              <tr>
                <th>Interest / Finance Costs</th>
                <td id="outInterestFinance">$0</td>
              </tr>
              <tr>
                <th>Balance After Interest</th>
                <td id="outAfterFinance">$0</td>
              </tr>
              <tr>
                <th>GST Reclaimed (add back)</th>
                <td id="outGstReclaimed">$0</td>
              </tr>
              <tr class="final">
                <th>Residual Land Value (DA Approved, Ex GST)</th>
                <td id="outIndicativeValue">$0</td>
              </tr>

              <tr class="group">
                <th>Key Ratios</th>
                <td></td>
              </tr>
              <tr>
                <th id="outGrossExLabel">Gross Realisation Ex GST (Selected Mode)</th>
                <td id="outGrossExSelected">$0</td>
              </tr>
              <tr>
                <th>Development Profit per Lot</th>
                <td id="outProfitPerLot">$0</td>
              </tr>
              <tr>
                <th>Break-even Sale Price per Lot (target margin)</th>
                <td id="outBreakEvenSalePerLot">$0</td>
              </tr>
              <tr>
                <th>Adopted Value per Hectare</th>
                <td id="outValuePerHectare">$0</td>
              </tr>
              <tr>
                <th>Adopted Value per Lot</th>
                <td id="outValuePerLot">$0</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </section>
  </main>

  <script>
    const pdfDefaults = {
      landSizeHa: 55,
      developablePct: 75,
      minimumLotSqm: 750,
      salePricePerLot: 364909.09,
      gstMode: "margin",
      marginPurchasePrice: 1200000,
      titlesLegalsPerLot: 2100,
      marketingPct: 1,
      agentsPct: 2.5,
      targetMarginPct: 22.46,
      constructionCost: 4950000,
      contingencyPct: 20,
      professionalFees: 950950,
      headworksCharges: 1060128,
      councilFees: 30000,
      acquisitionCosts: 318379,
      ratesTaxes: 59636,
      interestFinanceCosts: 1658445,
      gstReclaimed: 704708
    };

    const zeroDefaults = {
      landSizeHa: 0,
      developablePct: 0,
      minimumLotSqm: 0,
      salePricePerLot: 0,
      gstMode: "margin",
      marginPurchasePrice: 0,
      titlesLegalsPerLot: 0,
      marketingPct: 0,
      agentsPct: 0,
      targetMarginPct: 0,
      constructionCost: 0,
      contingencyPct: 0,
      professionalFees: 0,
      headworksCharges: 0,
      councilFees: 0,
      acquisitionCosts: 0,
      ratesTaxes: 0,
      interestFinanceCosts: 0,
      gstReclaimed: 0
    };

    const ids = Object.keys(pdfDefaults);
    const currencyFmt = new Intl.NumberFormat("en-AU", {
      style: "currency",
      currency: "AUD",
      maximumFractionDigits: 0
    });
    const numberFmt = new Intl.NumberFormat("en-AU", {
      maximumFractionDigits: 2
    });
    const GST_RATE = 0.10;

    function byId(id) {
      return document.getElementById(id);
    }

    function readNumber(id) {
      const value = Number.parseFloat(byId(id).value);
      return Number.isFinite(value) ? value : 0;
    }

    function setText(id, value) {
      byId(id).textContent = value;
    }

    function toCurrency(value) {
      return currencyFmt.format(Number.isFinite(value) ? value : 0);
    }

    function toNumber(value) {
      return numberFmt.format(Number.isFinite(value) ? value : 0);
    }

    function toPercent(value) {
      return `${toNumber(value)}%`;
    }

    function solveGrossForRequiredNet(requiredNetRealisation, titlesLegals, variableSellingRate, gstMode, marginPurchasePrice) {
      if (!Number.isFinite(requiredNetRealisation) || requiredNetRealisation <= 0) {
        return 0;
      }

      const gstFactor = GST_RATE / (1 + GST_RATE);

      if (gstMode !== "margin") {
        const denominator = 1 - variableSellingRate - gstFactor;
        if (denominator <= 0) {
          return Number.NaN;
        }
        return (requiredNetRealisation + titlesLegals) / denominator;
      }

      const denominatorAboveThreshold = 1 - variableSellingRate - gstFactor;
      let grossAboveThreshold = Number.NaN;

      if (denominatorAboveThreshold > 0) {
        grossAboveThreshold = (
          requiredNetRealisation +
          titlesLegals -
          (gstFactor * marginPurchasePrice)
        ) / denominatorAboveThreshold;
      }

      if (Number.isFinite(grossAboveThreshold) && grossAboveThreshold > marginPurchasePrice) {
        return Math.max(grossAboveThreshold, 0);
      }

      const denominatorBelowThreshold = 1 - variableSellingRate;
      if (denominatorBelowThreshold <= 0) {
        return Number.isFinite(grossAboveThreshold) ? Math.max(grossAboveThreshold, 0) : Number.NaN;
      }

      const grossBelowThreshold = (requiredNetRealisation + titlesLegals) / denominatorBelowThreshold;
      if (grossBelowThreshold <= marginPurchasePrice) {
        return Math.max(grossBelowThreshold, 0);
      }

      return Number.isFinite(grossAboveThreshold) ? Math.max(grossAboveThreshold, 0) : Number.NaN;
    }

    function loadValues(values) {
      for (const id of ids) {
        const node = byId(id);
        if (!node) {
          continue;
        }
        node.value = values[id];
      }
      syncModeInputState();
      update();
    }

    function loadPdfDefaults() {
      loadValues(pdfDefaults);
    }

    function loadZeroDefaults() {
      loadValues(zeroDefaults);
    }

    function syncModeInputState() {
      const isMargin = byId("gstMode").value === "margin";
      const marginRow = byId("marginPurchasePriceRow");
      marginRow.style.display = isMargin ? "grid" : "none";
      byId("marginPurchasePrice").disabled = !isMargin;
    }

    function updateWarnings(warnings) {
      const warningsNode = byId("warnings");
      if (warnings.length === 0) {
        warningsNode.classList.remove("show");
        warningsNode.replaceChildren();
        return;
      }

      warningsNode.classList.add("show");
      warningsNode.replaceChildren();
      warnings.forEach((item) => {
        const row = document.createElement("div");
        row.textContent = item;
        warningsNode.appendChild(row);
      });
    }

    function update() {
      const landSizeHa = readNumber("landSizeHa");
      const developablePct = readNumber("developablePct");
      const minimumLotSqm = readNumber("minimumLotSqm");
      const salePricePerLot = readNumber("salePricePerLot");
      const gstMode = byId("gstMode").value;
      const marginPurchasePrice = readNumber("marginPurchasePrice");
      const titlesLegalsPerLot = readNumber("titlesLegalsPerLot");
      const marketingPct = readNumber("marketingPct") / 100;
      const agentsPct = readNumber("agentsPct") / 100;
      const targetMargin = readNumber("targetMarginPct") / 100;
      const constructionCost = readNumber("constructionCost");
      const contingencyPct = readNumber("contingencyPct") / 100;
      const professionalFees = readNumber("professionalFees");
      const headworksCharges = readNumber("headworksCharges");
      const councilFees = readNumber("councilFees");
      const acquisitionCosts = readNumber("acquisitionCosts");
      const ratesTaxes = readNumber("ratesTaxes");
      const interestFinanceCosts = readNumber("interestFinanceCosts");
      const gstReclaimed = readNumber("gstReclaimed");

      const developableAreaHa = landSizeHa * (developablePct / 100);
      const calculatedLotsRaw = minimumLotSqm > 0 ? (developableAreaHa * 10000) / minimumLotSqm : 0;
      const totalLots = Math.max(Math.floor(calculatedLotsRaw), 0);

      const grossRealisation = salePricePerLot * totalLots;
      const gstNoMargin = grossRealisation * GST_RATE / (1 + GST_RATE);
      const gstMargin = Math.max(grossRealisation - marginPurchasePrice, 0) * GST_RATE / (1 + GST_RATE);
      const gstSalesRemittance = gstMode === "margin" ? gstMargin : gstNoMargin;
      const grossExMarginScheme = grossRealisation - gstMargin;
      const grossExNoMarginScheme = grossRealisation - gstNoMargin;
      const grossExSelected = gstMode === "margin" ? grossExMarginScheme : grossExNoMarginScheme;

      const titlesLegals = titlesLegalsPerLot * totalLots;
      const variableSellingRate = (marketingPct + agentsPct) * (1 + GST_RATE);
      const marketingAndCommissions = grossRealisation * variableSellingRate;
      const sellingCostsTotal = titlesLegals + marketingAndCommissions + gstSalesRemittance;
      const netRealisation = grossRealisation - sellingCostsTotal;

      const targetMarginDenominator = 1 + targetMargin;
      const marginForRisk = targetMarginDenominator > 0
        ? netRealisation * targetMargin / targetMarginDenominator
        : 0;
      const afterRisk = netRealisation - marginForRisk;

      const contingencyAllowance = constructionCost * contingencyPct;
      const constructionCostsTotal = constructionCost + contingencyAllowance + professionalFees + headworksCharges + councilFees;
      const afterConstruction = afterRisk - constructionCostsTotal;

      const purchaseHoldingTotal = acquisitionCosts + ratesTaxes;
      const afterPurchaseHolding = afterConstruction - purchaseHoldingTotal;
      const afterFinance = afterPurchaseHolding - interestFinanceCosts;
      const indicativeValue = afterFinance + gstReclaimed;

      const totalCostExProfit = constructionCostsTotal + purchaseHoldingTotal + interestFinanceCosts - gstReclaimed;
      const developmentProfit = marginForRisk;
      const developmentMargin = targetMargin * 100;
      const profitPerLot = totalLots > 0 ? developmentProfit / totalLots : 0;
      const valuePerHectare = developableAreaHa > 0 ? indicativeValue / developableAreaHa : 0;
      const valuePerLot = totalLots > 0 ? indicativeValue / totalLots : 0;

      const requiredNetForTarget = totalCostExProfit * (1 + targetMargin);
      const breakEvenGross = solveGrossForRequiredNet(
        requiredNetForTarget,
        titlesLegals,
        variableSellingRate,
        gstMode,
        marginPurchasePrice
      );
      const breakEvenSalePerLot = (totalLots > 0 && Number.isFinite(breakEvenGross))
        ? breakEvenGross / totalLots
        : Number.NaN;

      const warnings = [];
      if (indicativeValue < 0) {
        warnings.push("Residual land value is negative with current assumptions.");
      }
      if (variableSellingRate >= 1) {
        warnings.push("Marketing plus commissions are too high to support a feasible sale model.");
      }
      updateWarnings(warnings);

      setText("outLandValue", toCurrency(indicativeValue));
      setText("outProfit", toCurrency(developmentProfit));
      setText("outMargin", toPercent(developmentMargin));

      const landValueNode = byId("outLandValue");
      landValueNode.classList.toggle("danger", indicativeValue < 0);

      setText("outLandSizeHa", `${toNumber(landSizeHa)} ha`);
      setText("outDevelopableArea", `${toNumber(developableAreaHa)} ha`);
      setText("outTotalLots", toNumber(totalLots));
      setText("outSalePricePerLot", toCurrency(salePricePerLot));

      setText("outGrossRealisation", toCurrency(grossRealisation));
      setText("outTitlesLegals", toCurrency(titlesLegals));
      setText("outMarketingCommissions", toCurrency(marketingAndCommissions));
      setText("outGstSalesRemittance", toCurrency(gstSalesRemittance));
      setText("outSellingCostsTotal", toCurrency(sellingCostsTotal));
      setText("outNetRealisation", toCurrency(netRealisation));
      setText("outMarginForRisk", toCurrency(marginForRisk));
      setText("outAfterRisk", toCurrency(afterRisk));
      setText("outConstructionCostsTotal", toCurrency(constructionCostsTotal));
      setText("outAfterConstruction", toCurrency(afterConstruction));
      setText("outPurchaseHoldingTotal", toCurrency(purchaseHoldingTotal));
      setText("outAfterPurchaseHolding", toCurrency(afterPurchaseHolding));
      setText("outInterestFinance", toCurrency(interestFinanceCosts));
      setText("outAfterFinance", toCurrency(afterFinance));
      setText("outGstReclaimed", toCurrency(gstReclaimed));
      setText("outIndicativeValue", toCurrency(indicativeValue));

      setText(
        "outGrossExLabel",
        gstMode === "margin"
          ? "Gross Realisation Ex GST (Margin Scheme)"
          : "Gross Realisation Ex GST (GST)"
      );
      setText("outGrossExSelected", toCurrency(grossExSelected));
      setText("outProfitPerLot", toCurrency(profitPerLot));
      setText(
        "outBreakEvenSalePerLot",
        Number.isFinite(breakEvenSalePerLot) ? toCurrency(breakEvenSalePerLot) : "N/A"
      );
      setText("outValuePerHectare", toCurrency(valuePerHectare));
      setText("outValuePerLot", toCurrency(valuePerLot));
    }

    document.querySelectorAll("input, select").forEach((node) => {
      node.addEventListener("input", () => {
        syncModeInputState();
        update();
      });
      node.addEventListener("change", () => {
        syncModeInputState();
        update();
      });
    });

    byId("resetDefaults").addEventListener("click", loadPdfDefaults);
    loadZeroDefaults();
  </script>
</body>
</html>
